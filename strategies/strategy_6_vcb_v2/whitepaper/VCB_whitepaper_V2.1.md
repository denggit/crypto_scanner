# Volatility Compression Breakout（VCB）策略白皮书 V2.1

> 基于 V2.0 实盘反馈的参数校准与逻辑修复版  
> 适用场景：1m–5m 短线自动化交易（加密货币）  
> 核心目标：解决"倒在黎明前"的漏单问题，提升信号捕捉灵敏度

---

## 0. 修订说明（V2.1 的定位）

V2.1 针对 V2.0 代码运行中发现的"死板参数"问题进行了紧急修复：

- ❌ **修复**：1% 的突破阈值在短线中过高，导致还没触发开单系统就判定压缩结束。
- ❌ **修复**：波动率刚开始扩张（突破前兆）时，系统错误地判定为"压缩失效"并删除关注。
- ✅ **优化**：将突破判定从"滞后确认"改为"敏捷触发 + 延迟验证"。

---

## 一、策略总览（不变）

### 1.1 策略核心逻辑

1. 市场经历一段 **多维度波动率压缩**
2. 压缩形成明确的价格区间（结构）
3. 某一方向出现 **敏捷突破**（价格优先）
4. 波动率从"压缩态"切换至"扩张态"
5. 捕捉扩张初期的方向性收益

---

## 二、压缩判定系统（V2.1 核心升级）

### 2.1 多时间框架结构（保持）

```
Level 1：5m —— 主压缩识别（结构层）
Level 2：15m —— 背景验证（是否真的是"蓄势"）
Level 3：1m —— 入场与执行（时机层）
```

### 2.2 压缩评分系统（锁定机制）

V2.1 引入 **评分锁定（Score Locking）** 机制：

- 一旦压缩事件被创建且评分合格（Score ≥ 70），只要价格未破坏结构（未跌破下轨），评分将锁定或仅允许缓慢衰减。
- **目的**：防止突破前夕因均线发散导致分数骤降而漏单。

### 2.3 压缩事件结构与 TTL（重要修改）

#### TTL 规则（增加临界保护）

- 超过 N 根 K 线未突破 → 失效移除
- compression_score ↓ 到 60 以下 → 移除（除非处于临界态）

#### 【新增】临界状态保护 (Pre-Breakout Protection)

- 当价格进入 `[上轨 - 0.5%, 上轨]` 的临界区域时：
  - 暂时豁免 "ATR 回升"导致的失效判定
  - 暂时豁免 "评分下降"导致的移除操作
- **逻辑**：给行情一点时间去完成突破，不要在黎明前杀掉策略。

---

## 三、突破执行逻辑（V2.1 重点修正）

### 3.1 三重突破过滤机制

#### 第一层：价格 + 放量（参数下调）

- **【修正】有效突破幅度**：≥ 压缩区间的 **0.2%** (原 1%)
  - 说明：1% 在短线太远，0.2% 足以确认脱离原区间。
- **【修正】成交量**：≥ **1.2 × 20 均量** (原 1.5 倍)
  - 说明：允许温和放量启动，不做过严过滤。

#### 第二层：突破质量过滤

突破 K 线必须满足以下条件中的 **至少 3 条**：

1. 实体 ≥ 0.4 × ATR(14)
2. 影线短（假突破过滤，影线<50%实体）(原30%，适当放宽)
3. 成交量显著高于近期低点
4. 创局部新高 / 新低（动量）

#### 第三层：延迟确认（反噪声）

- 入场后观察 1–2 根 K 线
- 不允许价格重新回到突破边界内
- 成交量不能快速塌缩

---

## 四、仓位与执行（保持）

- 一次性建仓
- 仓位大小由账户风控模块统一管理
- 同一 symbol 同方向 **禁止重复入场**

---

## 五、平仓与风险管理

### 5.1 初始止损（结构优先）

止损 = **结构止损** 与 **ATR 动态止损** 中更保守者

```python
SL = max(struct_stop, atr_stop)  # 多头
SL = min(struct_stop, atr_stop)  # 空头
```

- **结构止损**：压缩区间反侧 ± 0.2×ATR
- **ATR 止损**：1.2 × ATR(20)

---

## 十、附录：技术参数修正表

### 多时间框架压缩判断框架（参数微调版）

#### Level 3 - 入场周期（1分钟）：精确入场时机

##### 1. 突破阈值计算（修正）

```python
# 基于5分钟周期确定的压缩区间
# 修正：大幅降低突破门槛，防止踏空

突破幅度 = 0.002  # 0.2% (原 1%)

上突破阈值 = 压缩区间上轨 * (1 + 突破幅度)
下突破阈值 = 压缩区间下轨 * (1 - 突破幅度)

# 临界保护区（新增）
# 当价格进入此区域，禁止系统删除压缩事件
上临界线 = 压缩区间上轨 * 0.995 
下临界线 = 压缩区间下轨 * 1.005
```

##### 2. 突破质量判断（修正）

```python
def check_breakout_quality(突破K线, direction):
    """
    突破K线质量评分（0-100分）
    """
    score = 0
    
    # 2. 成交量爆发（参数下调）
    成交量比率 = 突破K线.成交量 / MA(成交量, 20)
    
    if 成交量比率 > 1.5:        # 成交量>1.5倍（原2.0）
        score += 30
    elif 成交量比率 > 1.2:      # 成交量>1.2倍（原1.5）
        score += 20
    
    # ... 其他逻辑保持 ...
    
    return score
```

### 关键参数总结表（V2.1）

| 参数 | V2.0 (旧) | V2.1 (新) | 说明 |
|------|-----------|-----------|------|
| 突破幅度 | 1.0% | 0.2% | 核心修改：大幅降低门槛 |
| 突破预警幅度 | 0.5% | 0.1% | 提前预警 |
| 成交量爆发阈值 | 1.5倍 | 1.2倍 | 允许温和启动 |
| 影线控制阈值 | 30% | 50% | 放宽影线容忍度 |
| 临界保护区 | 无 | ±0.5% | 核心修改：防止黎明前失效 |

### 核心逻辑修正伪代码

```python
# strategy_6.py -> cleanup_compression_pool

def cleanup_compression_pool(self):
    current_price = get_current_price()
    
    # 计算是否处于临界突破区 (Distance < 0.5%)
    is_pre_breakout = abs(current_price - upper_bound) / upper_bound < 0.005
    
    # 如果 ATR 变大导致 invalid，但价格正在临界区，则【豁免】
    if event.is_invalid() and is_pre_breakout:
        logger.info("触发临界保护：价格逼近突破，暂不移除压缩事件")
        return  # 不删除
        
    if event.is_invalid():
        delete_event()
```

---

**版本**：V2.1  
**最后更新**：2025年  
**作者**：Zijun Deng
